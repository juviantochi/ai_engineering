
# Borrowers Data Inquiry API Documentation

**Tickets:** LND-4527  
**Parent:** LND-4525

*Purpose*: API contract for partner integration to query borrower merchant data enrichment. This endpoint allows authorized partners to retrieve merchant identification data using KTP number.

## Overview

| Item | Details                          |
| --- |----------------------------------|
| Service Name | `FS Brick Service - Borrowers Data Inquiry` |
| Owner | Lending Backend                  |
| Intended Audience | `External Partner`               |
| Base URL | see `environment details`.       |
| Version | `v1.0.0`                         |
| Last Updated | 2025-11-14                       |

---

## Authentication & Authorization

| Item | Guidance |
| --- | --- |
| Scheme | `HMAC-SHA256 Signature Authentication` |
| Required Headers | `veefin-x-partner-id`, `veefin-x-request-id`, `veefin-x-timestamp`, `veefin-x-signature` |
| Signature Algorithm | `HMAC-SHA256 with Base64 encoding` |
| Message Format | `partner-id\|request-id\|timestamp` |
| Timestamp Tolerance | `5 minutes` |
| IP Whitelisting | `Partner IP ranges will be configured during onboarding; contact support to request updates.` |

### Authentication Headers Detail

| Header | Type | Required | Description | Constraints |
| --- | --- | --- | --- | --- |
| `veefin-x-partner-id` | `string` | Yes | `Partner identifier assigned by BukuWarung` | `Alphanumeric, provided during onboarding` |
| `veefin-x-request-id` | `string` | Yes | `Unique request identifier for signature calculation` | `Exactly 16 characters, alphanumeric` |
| `veefin-x-timestamp` | `string` | Yes | `Request timestamp in Unix epoch seconds` | `Must be within 5 minutes of server time` |
| `veefin-x-signature` | `string` | Yes | `HMAC-SHA256 signature of message` | `Base64-encoded signature` |

### Signature Generation

**Message Construction:**
```
message = partner-id|request-id|timestamp
Example: "veefin|AbCd1234EfGh5678|1699876543"
```

**Signature Computation:**
```
signature = Base64(HMAC-SHA256(secret, message))
```

**Java Example:**
```java
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import java.nio.charset.StandardCharsets;
import java.util.Base64;

public class VeefinSignatureExample {

    public static String generateSignature(String partnerId, String requestId, String timestamp, String secret)
            throws Exception {
        // Construct message: partner-id|request-id|timestamp
        String message = partnerId + "|" + requestId + "|" + timestamp;

        // Compute HMAC-SHA256
        Mac mac = Mac.getInstance("HmacSHA256");
        SecretKeySpec secretKeySpec = new SecretKeySpec(secret.getBytes(StandardCharsets.UTF_8), "HmacSHA256");
        mac.init(secretKeySpec);
        byte[] hmacBytes = mac.doFinal(message.getBytes(StandardCharsets.UTF_8));

        // Encode to Base64
        return Base64.getEncoder().encodeToString(hmacBytes);
    }

    public static void main(String[] args) throws Exception {
        String partnerId = "veefin";
        String requestId = "AbCd1234EfGh5678";  // 16 characters
        String timestamp = String.valueOf(System.currentTimeMillis() / 1000);  // Unix epoch seconds
        String secret = "your-shared-secret-key";  // Provided during onboarding

        String signature = generateSignature(partnerId, requestId, timestamp, secret);

        System.out.println("veefin-x-partner-id: " + partnerId);
        System.out.println("veefin-x-request-id: " + requestId);
        System.out.println("veefin-x-timestamp: " + timestamp);
        System.out.println("veefin-x-signature: " + signature);
    }
}
```

---

## Environment Details

| Environment | Base URL | Authentication Notes |
| --- | --- | --- | --- |
| Staging | `https://staging-host/fs/brick/service` |
| Production | `https://prod-host/fs/brick/service` |

---

## Endpoint Summary

| Endpoint                               | Method | Purpose | Auth Required |
|----------------------------------------| --- | --- | --- |
| `fs/brick/veefin/v1/inquiry-borrowers` | `POST` | `Query borrower credit information using KTP number` | `Yes` |

---

## Endpoint Details

### `Borrowers Data Inquiry`

**Path & Method:** `POST /fs/brick/service/veefin/v1/inquiry-borrowers`

**Business Description:** Retrieves borrower merchant data enrichment information. This endpoint provides merchant identification data for credit assessment and risk evaluation purposes.

**Prerequisites:** Valid HMAC-SHA256 signature authentication headers (partner-id, request-id, timestamp, signature) must be provided. KTP number must be in valid Indonesian ID format (16 digits). Merchant data must exist for the provided KTP number.

#### Request

**Description:** Request requires valid KTP number and unique request ID for idempotency. All fields are mandatory. Request payload is lightweight with minimal validation overhead.

**Request Body:**
```json
{
  "ktpNumber": "1234567890123456",
  "requestId": "550e8400-e29b-41d4-a716-446655440000"
}
```

**Request Fields:**

| Field | Type | Required | Description | Constraints |
| --- | --- | --- | --- | --- |
| `ktpNumber` | `string` | Yes | `Indonesian KTP (ID card) number` | `Exactly 16 digits, numeric only` |
| `requestId` | `string` | Yes | `Unique identifier for idempotency and tracking` | `UUID v4 format` |

#### Response

**Description:** Returns borrower merchant data enrichment information. Response is synchronous with immediate data availability. Merchant data must exist; otherwise, a 404 error is returned.

**Success Response:**
```json
{
  "ktpNumber": "1234567890123456",
  "requestId": "550e8400-e29b-41d4-a716-446655440000",
  "code": 200,
  "description": "success",
  "data": {
    "merchantDataEnriched": {
      "merchantId": "MCH123456789"
    }
  }
}
```

**Response Fields:**

| Field | Type | Description |
| --- | --- | --- |
| `ktpNumber` | `string` | `Echoed KTP number from request` |
| `requestId` | `string` | `Echoed request ID from request` |
| `code` | `integer` | `HTTP status code mirrored in response body` |
| `description` | `string` | `Human-readable status description` |
| `data` | `object` | `Merchant data enrichment object (present only on success)` |
| `data.merchantDataEnriched` | `object` | `Enriched merchant data information (required)` |
| `data.merchantDataEnriched.merchantId` | `string` | `Unique merchant identifier` |

---

## Error Handling & Response Codes

### Standard Error Body

```json
{
  "ktpNumber": "1234567890123456",
  "requestId": "550e8400-e29b-41d4-a716-446655440000",
  "code": 400,
  "description": "Invalid KTP number format",
  "data": null
}
```

| Field | Type | Description |
| --- | --- | --- |
| `ktpNumber` | `string` | `Echoed KTP number from request (if provided)` |
| `requestId` | `string` | `Echoed request ID from request (if provided)` |
| `code` | `integer` | `HTTP status code mirrored in response body` |
| `description` | `string` | `Human-readable error description` |
| `data` | `null` | `Always null for error responses` |

### Error Catalogue

| HTTP Code | Scenario | Description | Client Guidance |
| --- | --- | --- | --- |
| `200` | `Success` | `Data found and returned successfully` | `Process returned data` |
| `400` | `Bad Request` | `Invalid KTP number format, missing fields, or malformed JSON` | `Validate input format and retry with correct data` |
| `401` | `Unauthorized - Missing Headers` | `Missing required authentication headers (partner-id, request-id, timestamp, or signature)` | `Ensure all four authentication headers are present and properly named` |
| `401` | `Unauthorized - Invalid Request ID` | `Request ID is not exactly 16 characters` | `Verify request-id is exactly 16 alphanumeric characters` |
| `401` | `Unauthorized - Invalid Timestamp` | `Timestamp is not valid Unix epoch seconds or outside 5-minute tolerance window` | `Generate fresh timestamp using System.currentTimeMillis() / 1000 and retry immediately` |
| `401` | `Unauthorized - Invalid Signature Format` | `Signature is not valid Base64 format` | `Verify signature is properly Base64-encoded` |
| `401` | `Unauthorized - Signature Verification Failed` | `HMAC-SHA256 signature does not match expected value` | `Verify message construction (partner-id\|request-id\|timestamp) and secret key are correct` |
| `404` | `Not Found` | `No merchant data found for the provided KTP number` | `KTP number does not have associated merchant data in the system` |
| `500` | `Internal Error` | `Unexpected server error` | `Retry with exponential backoff; contact support if persists` |

---

## Data Format & Validation Rules

### KTP Number Validation
- Must be exactly 16 digits
- Only numeric characters allowed
- No spaces, dashes, or other separators
- Must pass Indonesian KTP checksum validation (if applicable)

### Request ID Requirements
- Must be valid UUID v4 format
- Should be unique per request for proper idempotency
- Recommended to use timestamp-based UUID for easier tracking

---

## Integration Notes

### Idempotency
- Duplicate requests with the same `requestId` and `ktpNumber` return the previously recorded outcome through partner audit.
- Different `ktpNumber` with the same `requestId` result in error.

### Security Considerations
- **Signature Authentication**: HMAC-SHA256 provides cryptographic proof of request authenticity
- **Timestamp Validation**: 5-minute tolerance window prevents replay attacks
- **Constant-Time Comparison**: Signature verification uses constant-time comparison to prevent timing attacks
- **Request Logging**: All requests are logged for audit purposes with signature verification status
- **PII Protection**: Personal data is handled according to GDPR/local privacy regulations
- **Secret Management**: Shared secret keys are stored in AWS Secrets Manager and rotated regularly

---

## Change Log

| Version | Date         | Change Summary | Notes |
| --- |--------------| --- | --- |
| `v1.0.0` | `2025-11-14` | `Initial API contract definition` | `Contract-only release, implementation pending` |
